scalar DateTime
  @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")
scalar JSON @scalar(class: "Narsil\\GraphQL\\Scalars\\JSON")

extend type Query {
  block(id: ID! @eq): Block @find
  blocks: [Block!]! @all
  entity(id: ID! @eq): Entity @find
  entities: [Entity!]! @all
  field(id: ID! @eq): Field @find
  fields: [Field!]! @all
  fieldset(id: ID! @eq): Fieldset @find
  fieldsets: [Fieldset!]! @all
  form(id: ID! @eq): Form @find
  forms: [Form!]! @all
  input(id: ID! @eq): Input @find
  inputs: [Input!]! @all
  permission(id: ID! @eq): Permission @find
  permissions: [Permission!]! @all
  role(id: ID! @eq): Role @find
  roles: [Role!]! @all
  template(id: ID! @eq): Template @find
  templates: [Template!]! @all
  user(id: ID! @eq): User @find
  users: [User!]! @all
}

type Block @model(class: "Narsil\\Models\\Collections\\Block") {
  id: ID!
  collapsible: Boolean!
  handle: String!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
  blocks: [Block!]! @morphToMany
  elements: [BlockElement!]! @hasMany
  fields: [Field!]! @morphToMany
}

type BlockElement @model(class: "Narsil\\Models\\Collections\\BlockElement") {
  uuid: String!
  block_id: ID!
  description: String
  element_id: ID!
  element_type: String!
  field_id: ID!
  handle: String
  name: String
  owner_id: ID!
  position: Int!
  required: Boolean!
  translatable: Boolean!
  width: Int!
  block: Block! @belongsTo
  conditions: [BlockElementCondition!]! @hasMany
  field: Field! @belongsTo
  owner: Block! @belongsTo
}

type BlockElementCondition @model(class: "Narsil\\Models\\Collections\\BlockElementCondition") {
  uuid: String!
  block_element_uuid: String!
  handle: String!
  operator: String!
  value: String
  block_element: BlockElement! @belongsTo
}

type Entity @model(class: "Narsil\\Models\\Entities\\Entity") {
  uuid: String!
  id: ID!
  published_from: DateTime
  published_to: DateTime
  published: Boolean!
  revision: Int!
  slug: String!
  target_uuid: String!
  template_id: ID!
  created_at: DateTime!
  updated_at: DateTime!
  deleted_at: DateTime
  template: Template! @belongsTo
}

type EntityNode @model(class: "Narsil\\Models\\Entities\\EntityNode") {
  uuid: String!
  block_element_uuid: String
  block_id: ID
  element_id: String!
  element_type: String!
  owner_uuid: String!
  parent_uuid: String!
  path: String!
  template_tab_element_uuid: String
  value: String!
  block: Block @belongsTo
  children: [EntityNode!]! @hasMany
  element: HasElement! @morphTo
  entities: [EntityNodeRelation!]! @hasMany
  owner: Entity! @belongsTo
  parent: EntityNode @belongsTo
}

type EntityNodeRelation @model(class: "Narsil\\Models\\Entities\\EntityNodeRelation") {
  uuid: String!
  owner_node_uuid: String!
  owner_uuid: String!
  language: String!
  target_id: ID!
  target_type: String!
  entity: Entity! @belongsTo
  entity_node: EntityNode! @belongsTo
  target: Entity! @morphTo
}

type Field @model(class: "Narsil\\Models\\Collections\\Field") {
  id: ID!
  class_name: String
  description: String
  handle: String!
  name: String!
  required: Boolean!
  settings: String
  translatable: Boolean!
  type: String!
  type: String!
  created_at: DateTime!
  updated_at: DateTime!
  blocks: [Block!]! @belongsToMany
  options: [FieldOption!]! @hasMany
  validation_rules: [ValidationRule!]! @belongsToMany
}

type FieldBlock @model(class: "Narsil\\Models\\Collections\\FieldBlock") {
  uuid: String!
  block_id: ID!
  field_id: ID!
  block: Block! @belongsTo
  field: Field! @belongsTo
}

type FieldOption @model(class: "Narsil\\Models\\Collections\\FieldOption") {
  uuid: String!
  field_id: ID!
  label: String!
  position: Int!
  value: String!
  created_at: DateTime!
  updated_at: DateTime!
  field: Field! @belongsTo
}


type Fieldset @model(class: "Narsil\\Models\\Forms\\Fieldset") {
  id: ID!
  handle: String!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
  fielsets: [Fieldset!]! @morphToMany
  elements: [BlockElement!]! @hasMany
  inputs: [Input!]! @morphToMany
}

type FieldsetElement @model(class: "Narsil\\Models\\Forms\\FieldsetElement") {
  uuid: String!
  description: String
  element_id: ID!
  element_type: String!
  fieldset_id: ID!
  handle: String
  input_id: ID!
  name: String
  owner_id: ID!
  position: Int!
  required: Boolean!
  width: Int!
  conditions: [FieldsetElementCondition!]! @hasMany
  fieldset: Fieldset! @belongsTo
  input: Input! @belongsTo
  owner: Fieldset! @belongsTo
}

type FieldsetElementCondition @model(class: "Narsil\\Models\\Forms\\FieldsetElementCondition") {
  uuid: String!
  fieldset_element_uuid: String!
  handle: String!
  operator: String!
  value: String
  fieldset_element: FieldsetElement! @belongsTo
}

type FieldValidationRule @model(class: "Narsil\\Models\\Collections\\FieldValidationRule") {
  uuid: ID!
  field_id: ID!
  validarion_rule_id: ID!
  field: Field! @belongsTo
  validation_rule: ValidationRule! @belongsTo
}

type Form @model(class: "Narsil\\Models\\Forms\\Form") {
  id: ID!
  description: String!
  handle: String!
  title: String!
  created_at: DateTime!
  updated_at: DateTime!
}

type FormTab @model(class: "Narsil\\Models\\Forms\\FormTab") {
  uuid: ID!
  form_id: ID!
  handle: String!
  name: String!
  position: Int!
  created_at: DateTime!
  updated_at: DateTime!
  elements: [TemplateTabElement!]! @hasMany
  fieldsets: [Fieldset!]! @morphToMany
  form: Form! @belongsTo
  inputs: [Input!]! @morphToMany
}

type FormTabElement @model(class: "Narsil\\Models\\Forms\\FormTabElement") {
  uuid: String!
  description: String
  element_id: ID!
  element_type: String!
  fieldset_id: ID!
  handle: String
  input_id: ID!
  name: String
  owner_uuid: String!
  position: Int!
  required: Boolean!
  width: Int!
  conditions: [FormTabElementCondition!]! @hasMany
  fieldset: Fieldset! @belongsTo
  input: Input! @belongsTo
  owner: FormTab! @belongsTo
}

type FormTabElementCondition @model(class: "Narsil\\Models\\Forms\\FormTabElementCondition") {
  uuid: String!
  form_tab_element_uuid: String!
  handle: String!
  operator: String!
  value: String
  form_tab_element: FormTabElement! @belongsTo
}

type Input @model(class: "Narsil\\Models\\Forms\\Input") {
  id: ID!
  description: String
  handle: String!
  name: String!
  required: Boolean!
  settings: String
  type: String!
  created_at: DateTime!
  updated_at: DateTime!
  options: [InputOption!]! @hasMany
  validation_rules: [ValidationRule!]! @belongsToMany
}

type InputOption @model(class: "Narsil\\Models\\Forms\\InputOption") {
  uuid: String!
  input_id: ID!
  label: String!
  position: Int!
  value: String!
  created_at: DateTime!
  updated_at: DateTime!
  input: Input! @belongsTo
}

type InputValidationRule @model(class: "Narsil\\Models\\Forms\\InputValidationRule") {
  uuid: ID!
  input_id: ID!
  validarion_rule_id: ID!
  input: Input! @belongsTo
  validation_rule: ValidationRule! @belongsTo
}

type Permission @model(class: "Narsil\\Models\\Policies\\Permission") {
  id: ID!
  handle: String!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
  roles: [Role!]! @belongsToMany
}

type Role @model(class: "Narsil\\Models\\Policies\\Role") {
  id: ID!
  handle: String!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
  permissions: [Permission!]! @belongsToMany
}

type RolePermission @model(class: "Narsil\\Models\\Policies\\RolePermission") {
  uuid: String!
  permission_id: ID!
  role_id: ID!
  permission: Permission! @belongsTo
  role: Role! @belongsTo
}

type Template @model(class: "Narsil\\Models\\Collections\\Template") {
  id: ID!
  handle: String!
  plural: String!
  singular: String!
  created_at: DateTime!
  updated_at: DateTime!
}

type TemplateTab @model(class: "Narsil\\Models\\Collections\\TemplateTab") {
  uuid: ID!
  handle: String!
  name: String!
  position: Int!
  template_id: ID!
  created_at: DateTime!
  updated_at: DateTime!
  blocks: [Block!]! @morphToMany
  elements: [TemplateTabElement!]! @hasMany
  fields: [Field!]! @morphToMany
  template: Template! @belongsTo
}

type TemplateTabElement @model(class: "Narsil\\Models\\Collections\\TemplateTabElement") {
  uuid: String!
  block_id: ID!
  description: String
  element_id: ID!
  element_type: String!
  field_id: ID!
  handle: String
  name: String
  owner_uuid: String!
  position: Int!
  required: Boolean!
  translatable: Boolean!
  width: Int!
  block: Block! @belongsTo
  conditions: [TemplateTabElementCondition!]! @hasMany
  field: Field! @belongsTo
  owner: TemplateTab! @belongsTo
}

type TemplateTabElementCondition @model(class: "Narsil\\Models\\Collections\\TemplateTabElementCondition") {
  uuid: String!
  handle: String!
  operator: String!
  template_tab_element_uuid: String!
  value: String
  template_tab_element: TemplateTabElement! @belongsTo
}

type User @model(class: "Narsil\\Models\\User") {
  id: ID!
  avatar: String
  email: String!
  first_name: String
  full_name: String
  last_name: String
  created_at: DateTime!
  updated_at: DateTime!
  permissions: [Permission!]! @belongsToMany
  roles: [Role!]! @belongsToMany
}

type ValidationRule @model(class: "Narsil\\Models\\User") {
  id: ID!
  handle: String!
}

union Element = Block | Field | Fieldset | Input

union HasElement = BlockElement | TemplateTabElement
