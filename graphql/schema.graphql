scalar DateTime
  @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")
scalar JSON @scalar(class: "Narsil\\GraphQL\\Scalars\\JSON")

extend type Query {
  block(id: ID! @eq): Block @find
  blocks: [Block!]! @all
  field(id: ID! @eq): Field @find
  fields: [Field!]! @all
  permission(id: Int! @eq): Permission @find
  permissions: [Permission!]! @all
  relations(owner_table: String!, owner_id: ID!): [Relation!]!
    @field(
      resolver: "Narsil\\GraphQL\\Resolvers\\RelationResolver@resolveEntities"
    )
  role(id: Int! @eq): Role @find
  roles: [Role!]! @all
  template(id: Int! @eq): Template @find
  templates: [Template!]! @all
  user(id: Int! @eq): User @find
  users: [User!]! @all
}

type Block @model(class: "Narsil\\Models\\Elements\\Block") {
  id: ID!
  handle: String!
  icon: String!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
  blocks: [Block!]! @morphToMany
  elements: [BlockElement!]! @hasMany
  fields: [Field!]! @morphToMany
}

type BlockElement @model(class: "Narsil\\Models\\Elements\\BlockElement") {
  id: ID!
  block_id: ID!
  element_id: ID!
  element_type: String!
  handle: String!
  icon: String!
  name: String!
  position: Int!
  width: Int!
  block: Block! @belongsTo
  conditions: [BlockElementCondition!]! @hasMany
  element: Element! @morphTo
}

type BlockElementCondition
  @model(class: "Narsil\\Models\\Elements\\BlockElementCondition") {
  id: ID!
  owner_id: Int!
  key: String!
  operator: String!
  value: String
}

type Field @model(class: "Narsil\\Models\\Elements\\Field") {
  id: ID!
  handle: String!
  name: String!
  description: String
  type: String!
  settings: String
  translatable: Boolean!
  icon: String
  created_at: DateTime!
  updated_at: DateTime!
  blocks: [Block!]! @belongsToMany
  options: [FieldOption!]! @hasMany
}

type FieldOption @model(class: "Narsil\\Models\\Elements\\FieldOption") {
  id: ID!
  field_id: Int!
  key: String!
  value: String!
  position: Int!
  created_at: DateTime!
  updated_at: DateTime!
}

type Permission @model(class: "Narsil\\Models\\Policies\\Permission") {
  id: ID!
  category: String!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
  roles: [Role!]! @belongsToMany
}

type Relation @model(class: "Narsil\\Models\\Entities\\Relation") {
  deleted_at: DateTime!
  id: ID!
  owner_id: ID!
  owner_table: String!
  owner_uuid: String!
  target_id: ID!
  target_table: String!
}

type Role @model(class: "Narsil\\Models\\Policies\\Role") {
  id: ID!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
  permissions: [Permission!]! @belongsToMany
}

type Template @model(class: "Narsil\\Models\\Elements\\Template") {
  id: ID!
  handle: String!
  name: String!
  created_at: DateTime!
  updated_at: DateTime!
}

type TemplateSection
  @model(class: "Narsil\\Models\\Elements\\TemplateSection") {
  id: ID!
  handle: String!
  name: String!
  position: Int!
  template_id: ID!
  created_at: DateTime!
  updated_at: DateTime!
  blocks: [Block!]! @morphToMany
  elements: [TemplateSectionElement!]! @hasMany
  fields: [Field!]! @morphToMany
  template: Template! @belongsTo
}

type TemplateSectionElement
  @model(class: "Narsil\\Models\\Elements\\TemplateSectionElement") {
  id: ID!
  element_id: ID!
  element_type: String!
  handle: String!
  icon: String!
  name: String!
  position: Int!
  template_section_d: ID!
  width: Int!
  element: Element! @morphTo
  templateSection: TemplateSection! @belongsTo
}

type User @model(class: "Narsil\\Models\\User") {
  id: ID!
  avatar: String
  first_name: String
  full_name: String
  last_name: String
  email: String!
  created_at: DateTime!
  updated_at: DateTime!
  permissions: [Permission!]! @belongsToMany
  roles: [Role!]! @belongsToMany
}

union Element = Block | Field
